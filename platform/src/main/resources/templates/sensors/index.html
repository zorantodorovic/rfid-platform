<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Sensors</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/index.css"/>
    <link rel="stylesheet" href="/assets/css/header.css" type="text/css"/>

    <!-- ne treba verzija jer webjars automatski stavi-->
    <script type="text/javascript" src='/webjars/jquery/jquery.min.js'></script>

    <script src="/webjarsjs"></script>
    <script data-main="/js/app" src="/webjars/requirejs/require.min.js"></script>
</head>
<body>

<div th:include="/shared/menu :: menu"></div>
    <table border="2" width="70%" cellpadding="2">
        <tr><th>Id</th><th>Ip address</th><th>Type</th><th>Sinks</th><th></th><th></th></tr>

            <tr th:each="item : ${sensors}">
                <td th:text="${item.key.id}"></td>
                <td th:text="${item.key.ipAddress}"></td>
                <td th:text="${item.key.sensorType}"></td>
                <td>
                        <ul th:each="sink : ${item.value}">
                            <li th:text="${sink.uri}"></li>
                        </ul>
                </td>
                <td><a href="#" class="ping" th:id="${item.key.id}">Ping</a></td>
                <td><a href="#" class="calibrate" th:id="${item.key.id}">Calibrate</a></td>
                <td><a th:href="${'edit/' + item.key.id}">Edit</a></td>
                <td><a th:href="${'delete/' + item.key.id}">Delete</a></td>
            </tr>
    </table>
    <br/>
    <a href="add">Add Sensor</a>
</body>
<script>
    var getUrl = window.location;
    var baseUrl = getUrl .protocol + "//" + getUrl.host + "/";
    $(".ping").click(function(e){
        var id = e.target.id;
        $.get(baseUrl+ "/rest/iot/ping?id=" + id, function(data, status){
            if(data) {
                window.alert("PING! ALIVE!");
            } else {
                window.alert("DEAD!");
            }
        });
    });

    $(".calibrate").click(function(e){
        var id = e.target.id;
        $.get(baseUrl+ "/rest/iot/changeIp?id=" + id, function(data, status){
            if(data) {
                window.alert("Success!");
            } else {
                window.alert("Failure!");
            }
        });
    });

</script>
</html>